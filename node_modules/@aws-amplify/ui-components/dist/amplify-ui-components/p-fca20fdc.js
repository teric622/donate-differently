import{Logger as e,isEmpty as r}from"@aws-amplify/core";import{A as t,C as o}from"./p-417bb5ea.js";import{Auth as s}from"@aws-amplify/auth";import{N as a}from"./p-50fc1c0c.js";import{a as c}from"./p-6b3bc6eb.js";const n=new e("auth-helpers");async function i(e,o){if(!s||"function"!=typeof s.verifiedContact)throw new Error(a);try{const a=await s.verifiedContact(e);if(!r(a.verified)||r(a.unverified))o(t.SignedIn,e);else{const r=Object.assign(e,a);o(t.VerifyContact,r)}}catch(n){c(n)}}const f=async(e,r,f)=>{if(!s||"function"!=typeof s.signIn)throw new Error(a);try{const a=await s.signIn(e,r);n.debug(a),a.challengeName===o.SMSMFA||a.challengeName===o.SoftwareTokenMFA?(n.debug("confirm user with "+a.challengeName),f(t.ConfirmSignIn,a)):a.challengeName===o.NewPasswordRequired?(n.debug("require new password",a.challengeParam),f(t.ResetPassword,a)):a.challengeName===o.MFASetup?(n.debug("TOTP setup",a.challengeParam),f(t.TOTPSetup,a)):a.challengeName===o.CustomChallenge&&a.challengeParam&&"true"===a.challengeParam.trigger?(n.debug("custom challenge",a.challengeParam),f(t.CustomConfirmSignIn,a)):await i(a,f)}catch(p){c(p),"UserNotConfirmedException"===p.code?(n.debug("the user is not confirmed"),f(t.ConfirmSignUp,{username:e})):"PasswordResetRequiredException"===p.code&&(n.debug("the user requires a new password"),f(t.ForgotPassword,{username:e}))}};export{i as c,f as h}